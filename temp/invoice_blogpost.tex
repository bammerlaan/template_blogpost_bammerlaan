% !TeX program = lualatex

% Warning: template parts using for loops give an error when they are indented.
%See when having trouble using graphicx with invoice: http://tex.stackexchange.com/questions/61113/using-graphicx-with-invoice-results-in-strange-pdf-output

\documentclass[paper=a4,fontsize=11pt,DIV=12]{scrlttr2}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[gen]{eurosym}
\usepackage{ucs}
\usepackage[utf8x]{inputenc}
\usepackage{microtype}
\usepackage{dcolumn}
\usepackage{booktabs}
\usepackage[english]{babel}
\usepackage{underscore}
%\usepackage{float, caption}
\usepackage{graphicx}
%\usepackage{invoice_bammerlaan}
\usepackage{fp}
\usepackage{changepage} % Allow moving table slightly to left
\usepackage{fontspec} % Load fontspec for Roboto Light font
\setmainfont[BoldFont={Roboto-Regular.ttf}]{Roboto-Light.ttf}
\usepackage{mathastext}
\usepackage{wallpaper}

\LoadLetterOption{DINmtext}
\KOMAoptions{enlargefirstpage=true,fromalign=right,fromphone=true,fromemail=true,fromurl=true,fromlogo=true,backaddress=false,parskip=half*,firstfoot=true}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Set global variables here:

% (Company) Name
\setkomavar{fromname}{Firstname Lastname, occupation}
% Address
\setkomavar{fromaddress}{%
	Streetname 1\\
	1234 AB City Name
}
% Phone number
\setkomavar{fromphone}{06 123 456 78}
% E-mail address
\setkomavar{fromemail}{test@test.nl}
% Bank account number
\setkomavar{frombank}{NL12 TEST 1234 5678 90}
% Website
\setkomavar{fromurl}{http://www.bammerlaan.nl}
% Chamber of commerce number
\newcommand{\KVKNummer}{12345678}
% VAT number
\newcommand{\BTWNummer}{NL123456789A01}

%%%%%%%% Files %%%%%%%%

% Path to LaTeX template (so graphics can also be found when run from another directory) (REPLACE WITH YOUR OWN):
\graphicspath{ {/home/user/yourdirectoryhere} }

% Path to background image
\ULCornerWallPaper{1}{achtergrond_facuur.pdf}

% Path to logo
\setkomavar{fromlogo}{\includegraphics[]{Bas_zang_logo_v6-3_alleen_vierkant.pdf}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\setkomavar{firstfoot}{%
	\parbox[t]{\textwidth}{\footnotesize
		\begin{tabular}[t]{l@{}}%
			\multicolumn{1}{@{}l@{}}{Chamber of commerce: \KVKNummer{}}
		\end{tabular}%
		\hfill
		\begin{tabular}[t]{l@{}}%
			\multicolumn{1}{@{}l@{}}{IBAN: \usekomavar{frombank}}
		\end{tabular}%
		\hfill
		\begin{tabular}[t]{l@{}}%
			\multicolumn{1}{@{}l@{}}{VAR number: 
				\BTWNummer{}}
		\end{tabular}%
	}%
}


% Uncomment for European date entries. Also uncomment line starting with "\parsedate}" below. --- see: http://tex.stackexchange.com/questions/54594/tex-capacity-exceeded-while-parsing-a-date-string
%\def\parsedate#1{\edef\temp{#1}%
%	\expandafter\parsedateX\temp\relax}
%\def\parsedateX #1-#2-#3\relax{%
%	\def\dueyear{#1}%
%	\def\duemonth{#2}%
%	\def\dueday{#3}}

% Prevent indentation of signature: 
\renewcommand*{\raggedsignature}{\raggedright}


\begin{document}
	
	\begin{letter}{To:\\
			Customer Name\\
Address 1\\
1234 AB City\\
		}
		
		
%		\setkomavar{subject}{%
%			None}
		\setkomavar{subject}{Invoice}		
		\setkomavar{invoice}[Invoice number]{46}
		
		\opening{Dear sir/madam,}
		
		Please transfer the amount due within 30 days to bank account number \usekomavar{frombank} in the name of \textbf{Firstname Lastname, occupation} giving your \underline{name} and the \underline{invoice number}.
			
	\begin{adjustwidth}{-2em}{} % Move table slightly left	
		\begin{tabular}{
				l
				p{10em}
				D{,}{,}{2}
				l
				l
				D{,}{,}{2}
				l
				l
			}
			\multicolumn{1}{p{5em}}{\flushleft Date} & % Date
			\multicolumn{1}{p{10em}}{\flushleft Description} & % Description
			\multicolumn{1}{p{3em}}{\flushleft Amount} & % Amount
			\multicolumn{1}{p{3em}}{\flushleft Unit price} & % Unit price
			\multicolumn{1}{p{5em}}{\flushleft Amount without tax} & % Amount without tax
			\multicolumn{1}{p{3em}}{\flushleft Tax\\rate} & % Tax rate
			\multicolumn{1}{p{3em}}{\flushleft Tax\\amount} & % Tax amount
			\multicolumn{1}{p{5em}}{\flushleft Total price\\with\\taxes}\\ \midrule % Total price with taxes
2020-01-22 & % Date
% Comment the above and uncomment the below for European dates:
%\parsedate{2020-01-22} \dueday-\duemonth-\dueyear & % DATUM
Product 1 & % Description
1 & % Amount
\euro{} 55,00 & % Unit price
\euro{} 55,00 & % Amount without tax
9\% & % GEBRUIKTE BTW-TARIEF
\euro{} 4,95 & % Tax rate
%Stichting Barokconcerten Nederland 
\euro{} 59,95 \\ % Total price with taxes
2020-01-23 & % Date
% Comment the above and uncomment the below for European dates:
%\parsedate{2020-01-23} \dueday-\duemonth-\dueyear & % DATUM
Product 1 & % Description
1 & % Amount
\euro{} 55,00 & % Unit price
\euro{} 55,00 & % Amount without tax
9\% & % GEBRUIKTE BTW-TARIEF
\euro{} 4,95 & % Tax rate
%Stichting Barokconcerten Nederland 
\euro{} 59,95 \\ % Total price with taxes
2020-01-24 & % Date
% Comment the above and uncomment the below for European dates:
%\parsedate{2020-01-24} \dueday-\duemonth-\dueyear & % DATUM
Product 2 & % Description
1 & % Amount
\euro{} 170,00 & % Unit price
\euro{} 170,00 & % Amount without tax
9\% & % GEBRUIKTE BTW-TARIEF
\euro{} 15,30 & % Tax rate
%Stichting Barokconcerten Nederland 
\euro{} 185,30 \\ % Total price with taxes
2020-01-25 & % Date
% Comment the above and uncomment the below for European dates:
%\parsedate{2020-01-25} \dueday-\duemonth-\dueyear & % DATUM
Product 2 & % Description
1 & % Amount
\euro{} 170,00 & % Unit price
\euro{} 170,00 & % Amount without tax
9\% & % GEBRUIKTE BTW-TARIEF
\euro{} 15,30 & % Tax rate
%Stichting Barokconcerten Nederland 
\euro{} 185,30 \\ % Total price with taxes
2020-01-26 & % Date
% Comment the above and uncomment the below for European dates:
%\parsedate{2020-01-26} \dueday-\duemonth-\dueyear & % DATUM
Product 2 & % Description
1 & % Amount
\euro{} 170,00 & % Unit price
\euro{} 170,00 & % Amount without tax
9\% & % GEBRUIKTE BTW-TARIEF
\euro{} 15,30 & % Tax rate
%Stichting Barokconcerten Nederland 
\euro{} 185,30 \\ % Total price with taxes
			\midrule
			&	Sub-total	& &	 & \euro{} 620,00	&       &  \euro{} 55,80     &	\euro{} 675,80\\ \cmidrule{8-8}
%			&	+ BTW &	&  &     &   &    &	\euro{} 55,80 \\ \cmidrule{8-8}
			&	\large\textbf{Amount due} &		&  &     &    &   &	\textbf{\scalebox{1.2}{\euro{} 675,80}} \\

% If discount:			
			
%			&	\multicolumn{2}{l}{Extra korting} &  & &   &   &	\euro{} 62,00 \\ \cmidrule{8-8}
%			&	\textbf{Totaal te voldoen met aftrek van korting} &  & &   &   &	& \euro{} 613,80
		\end{tabular}
	\end{adjustwidth}				
		\closing{Yours sincerely,}
	\end{letter}
\end{document}